
# ğŸš€ Airflow í•˜ë£¨ í•™ìŠµ ë‚´ìš© ì •ë¦¬ (ê·¸ë¦¼ Â· ì‰¬ìš´ ì„¤ëª… Â· ê¹Šì€ ì´í•´)

ê¹€ì‹¸í”¼ê°€ í•˜ë£¨ ë™ì•ˆ ê²½í—˜í•œ Airflow ì‹¤ìŠµ ë‚´ìš©ì„  
**ì´ˆë³´ë„ ì´í•´í•  ìˆ˜ ìˆëŠ” ë¹„ìœ **ì™€  
**ê¸°ëŠ¥ë³„ ê·¸ë¦¼**,  
**ê¹Šì€ ì›ë¦¬**,  
**ì˜ˆì œ ì½”ë“œ**,  
**Airflow ì „ì²´ ì‘ë™ íë¦„**ìœ¼ë¡œ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

---

# ğŸ“Œ 1. Airflowê°€ í•˜ëŠ” ì¼ì„ ê°€ì¥ ì‰½ê²Œ ì„¤ëª…í•˜ë©´?

AirflowëŠ” í•œë§ˆë””ë¡œ **ìë™ìœ¼ë¡œ ì¼ì„ ì²˜ë¦¬í•˜ëŠ” ê³µì¥ ê´€ë¦¬ì**ì´ë‹¤.

- ë§¤ì¼ 9ì‹œì— í¬ë¡¤ë§ ì‹¤í–‰í•´ì¤˜  
- 6ì‹œê°„ë§ˆë‹¤ ë¡œê·¸ ì •ë¦¬í•´ì¤˜  
- ë§¤ì¼ ìƒˆë²½ 3ì‹œì— ë°ì´í„° ì ì¬í•´ì¤˜

â†’ ì´ëŸ° â€œì¼ì •í•œ ì‹œê°„ì— í•´ì•¼ í•˜ëŠ” ì‘ì—…(Task)â€ì„ **Airflowê°€ ì•Œì•„ì„œ ì‹¤í–‰**í•œë‹¤.

ì¦‰, ì‚¬ëŒ ëŒ€ì‹  ì¼ì„ ì‹œí‚¤ê³ (ìŠ¤ì¼€ì¤„ë§),  
ì¼ê¾¼ì„ ê´€ë¦¬í•˜ë©°(ì›Œì»¤),  
ì¼ì´ ëë‚¬ëŠ”ì§€ ê¸°ë¡ì„ ë‚¨ê¸°ê³ (ë¡œê·¸/DB),  
ë¬¸ì œê°€ ìˆìœ¼ë©´ ì•Œë¦¼ê¹Œì§€ í•´ì¤€ë‹¤.

---

# ğŸ“Œ 2. Airflowë¥¼ ì‰½ê²Œ ë¹„ìœ í•˜ë©´?

AirflowëŠ” â€œìë™ ê³µì¥â€ì´ë‹¤.

## ğŸ”§ Airflow ë‚´ë¶€ êµ¬ì„± ë¹„ìœ 

| Airflow êµ¬ì„± ìš”ì†Œ | ë¹„ìœ  | ì—­í•  ì„¤ëª… |
|------------------|--------|----------------|
| **Scheduler** | ê³µì¥ ê´€ë¦¬ì | ì–¸ì œ ì–´ë–¤ ì¼ì„ í•´ì•¼ í•˜ëŠ”ì§€ íŒë‹¨ |
| **Worker** | ê³µì¥ ì¼ê¾¼ | ì‹¤ì œë¡œ ì¼ì„ í•¨ (Python ì‹¤í–‰) |
| **Webserver** | ëª¨ë‹ˆí„°ë§ í™”ë©´ | ê³µì¥ì´ ì§€ê¸ˆ ë­˜ í•˜ê³  ìˆëŠ”ì§€ ë³´ì—¬ì¤Œ |
| **Redis** | ë¬´ì „ê¸° | ê´€ë¦¬ì â†’ ì¼ê¾¼ì—ê²Œ ì‘ì—… ì „ë‹¬ |
| **Postgres(DB)** | ê¸°ë¡ ì°½ê³  | ëª¨ë“  ì‘ì—… ê²°ê³¼ì™€ íˆìŠ¤í† ë¦¬ ì €ì¥ |
| **DAG íŒŒì¼** | ì‘ì—… ì§€ì‹œì„œ | ê³µì¥ì— ì–´ë–¤ ì¼ì„ ì–´ë–¤ ìˆœì„œë¡œ í•˜ë¼ê³  ì „ë‹¬ |

ì´ê±¸ ê·¸ë¦¼ìœ¼ë¡œ ë‚˜íƒ€ë‚´ë©´:

```

[DAG íŒŒì¼]
â†“
[Scheduler] â†’ ì‘ì—… ì¼ì • í™•ì¸
â†“
(ì „ë‹¬)
Redis(ë¬´ì „ê¸°)
â†“
[Worker] â†’ Python ì½”ë“œ ì‹¤í–‰
â†“
[Postgres] â†’ ì‘ì—… ê²°ê³¼ ì €ì¥
â†“
[Webserver] â†’ UIì—ì„œ ìƒíƒœ í™•ì¸

```

---

# ğŸ“Œ 3. ì˜¤ëŠ˜ ë§Œë“  DAG ì˜ˆì‹œ ê·¸ë¦¼

DAG = Directed Acyclic Graph = **ì‘ì—… íë¦„ë„**

ì˜¤ëŠ˜ ë§Œë“  ì˜ˆ:

```

start â†’ end

```

ë˜ ë‹¤ë¥¸ DAG:

```

select_fruit â†’ ì™„ë£Œ

```

ì‹¤íŒ¨í•  ìˆ˜ë„ ìˆëŠ” DAG:

```

logging_task â†’ (ì„±ê³µ or ì‹¤íŒ¨)

````

ì´ DAGë“¤ì´ Airflow UIì— ìƒìë¡œ ë‚˜íƒ€ë‚œë‹¤.

---

# ğŸ“Œ 4. Airflow ì„¤ì¹˜ ê³¼ì • (Docker ê¸°ë°˜)

ì´ê±´ ê³µì¥ì„ ì²˜ìŒ ì„¸íŒ…í•˜ëŠ” ê³¼ì •ì´ì—ˆë‹¤.

### âœ¨ ë„¤ê°€ ì‹¤ì œë¡œ í•œ ê³¼ì •

```bash
mkdir ssafy_airflow
cd ssafy_airflow

curl -LfO https://airflow.apache.org/docs/apache-airflow/2.10.5/docker-compose.yaml

mkdir dags logs plugins config
echo "AIRFLOW_UID=$(id -u)" > .env

docker network create shared-net
sudo docker compose up -d
````

### âœ” í•µì‹¬ ê°œë…

* AirflowëŠ” ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆ(webserver, worker, scheduler ë“±)ì´ í•¨ê»˜ ë™ì‘í•´ì•¼ í•œë‹¤.
* ê·¸ë˜ì„œ Docker Composeë¡œ í•œ ë²ˆì— ì „ì²´ ê³µì¥ì„ ë„ìš°ëŠ” ê²ƒ.

---

# ğŸ“Œ 5. DAG íŒŒì¼ì´ ì–´ë–»ê²Œ ë“±ë¡ë˜ëŠ”ì§€(í•µì‹¬ ì¤‘ í•µì‹¬)

AirflowëŠ” `dags/` í´ë”ë¥¼ ê³„ì† ê°ì‹œí•˜ê³  ìˆë‹¤.

```
1) dags í´ë”ì— .py íŒŒì¼ ìƒì„±
2) Schedulerì™€ Webserverê°€ í•´ë‹¹ íŒŒì¼ì„ importí•¨
3) DAG ê°ì²´ë¥¼ ì°¾ìŒ
4) ë©”íƒ€ë°ì´í„° DBì— ì €ì¥
5) UIì— ë°”ë¡œ ë‚˜íƒ€ë‚¨
```

ì¦‰, **íŒŒì¼ë§Œ ë„£ì–´ë„ ìë™ ë“±ë¡ë¨**.

---

# ğŸ“Œ 6. ì˜¤ëŠ˜ ë§Œë“  PythonOperator ì˜ˆì œ

```python
from airflow import DAG
from airflow.operators.python import PythonOperator
import pendulum

def print_hello():
    print("Hello, Airflow!")

with DAG(
    dag_id="hello_python_dag",
    schedule="@once",
    start_date=pendulum.today("Asia/Seoul"),
    catchup=False,
):
    hello_task = PythonOperator(
        task_id="hello_task",
        python_callable=print_hello,
    )

    hello_task
```

âœ” Workerê°€ ì‹¤ì œë¡œ `print_hello()` ì‹¤í–‰í•¨
âœ” ê²°ê³¼ëŠ” UI â†’ Logsì—ì„œ í™•ì¸ ê°€ëŠ¥

---

# ğŸ“Œ 7. ëœë¤ ê³¼ì¼ ì„ íƒ DAG â€” ìŠ¤ì¼€ì¤„ë§ ì‹¤ìŠµ

```
ë§¤ì¼ ì˜¤ì „ 6ì‹œ 30ë¶„ ì‹¤í–‰
```

```python
schedule="30 6 * * *"
```

```python
def select_fruit():
    fruits = ["APPLE", "BANANA", "ORANGE", "AVOCADO"]
    idx = random.randint(0, 3)
    print(fruits[idx])
```

âœ” ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ë‹¤ë¥¸ ê³¼ì¼ ì¶œë ¥
âœ” Worker ë¡œê·¸ì—ì„œ ë°”ë¡œ í™•ì¸

---

# ğŸ“Œ 8. ì„±ê³µ/ì‹¤íŒ¨ ì‹œë®¬ë ˆì´ì…˜ â€” logging + ì˜ˆì™¸ ì²˜ë¦¬

```python
logging.info("Task ì‹¤í–‰ë¨")
print("í‘œì¤€ ì¶œë ¥ì…ë‹ˆë‹¤.")

if random.choice([True, False]):
    logging.info("ì„±ê³µ!")
else:
    logging.error("ì‹¤íŒ¨!")
    raise Exception("ì˜ë„ì ì¸ ì‹¤íŒ¨ ë°œìƒ")
```

### ì´ê±¸ í†µí•´ ë°°ìš´ ê²ƒ

* ë¡œê·¸ ì¶œë ¥ ë°©ë²•
* ì˜¤ë¥˜ ë°œìƒ ë°©ë²• (`raise Exception`)
* Airflowê°€ ì‹¤íŒ¨ë¥¼ UIì—ì„œ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ì´ìœ 
* ì‹¤íŒ¨ ë¡œê·¸ í™•ì¸ ë°©ë²•

---

# ğŸ“Œ 9. DAG ìŠ¤ì¼€ì¤„ë§ ê°œë… ì •ë¦¬ (ì¤‘ìš”)

| ì„¤ì •                     | ì˜ë¯¸                  |
| ---------------------- | ------------------- |
| `schedule="@once"`     | í•œ ë²ˆë§Œ ì‹¤í–‰             |
| `schedule="0 9 * * *"` | ë§¤ì¼ ì˜¤ì „ 9ì‹œ            |
| `catchup=False`        | ê³¼ê±° ì‹¤í–‰ ë°©ì§€            |
| `start_date=`          | DAG ì‹œì‘ ì‹œì            |
| `dagrun_timeout=`      | DAGì´ ë„ˆë¬´ ì˜¤ë˜ ëŒë©´ ê°•ì œ ì¢…ë£Œ |

ì´ê±¸ ììœ ìì¬ë¡œ ë‹¤ë£° ìˆ˜ ìˆê²Œ ë¨.

---

# ğŸ“Œ 10. DAG ì‹¤í–‰ íë¦„ ì „ì²´ ê·¸ë¦¼

```
DAG íŒŒì¼ ì‘ì„±
     â†“
Airflowê°€ íŒŒì¼ ì½ê³  UI ë“±ë¡
     â†“
Schedulerê°€ ìŠ¤ì¼€ì¤„ ì‹œê°„ ê³„ì‚°
     â†“
TaskInstance ìƒì„±
     â†“
Redisë¡œ ë©”ì‹œì§€ ì „ë‹¬
     â†“
Workerê°€ Python í•¨ìˆ˜ ì‹¤í–‰
     â†“
Log/DBì— ê¸°ë¡ ì €ì¥
     â†“
UIì—ì„œ ê²°ê³¼ í™•ì¸ (ì´ˆë¡/ë¹¨ê°•)
```

ì´ íë¦„ì„ ì˜¤ëŠ˜ ì²˜ìŒë¶€í„° ëê¹Œì§€ ì§ì ‘ ê²½í—˜í•œ ê±°ì•¼.

---

# ğŸ“Œ 11. Airflow ì¬ì‹œì‘ ë°©ë²• (ìš´ì˜ ê¸°ë³¸)

```bash
sudo docker compose down
sudo docker compose up -d
```

ë˜ëŠ” ì„œë¹„ìŠ¤ë§Œ ì¬ì‹œì‘:

```bash
sudo docker compose restart airflow-webserver
```

ì´ê²ƒê¹Œì§€ ë„¤ê°€ ì§ì ‘ ì¨ë´„.

---

# ğŸ“Œ 12. ì˜¤ëŠ˜ í•˜ë£¨ ë°°ìš´ ì¤‘ìš”í•œ ê°œë… ìš”ì•½

* Airflowê°€ ì™œ í•„ìš”í•œì§€
* DAG êµ¬ì¡°
* Taskì™€ Operator ê°œë…
* ìŠ¤ì¼€ì¤„ë§(Cron)
* Workerì™€ Scheduler ì—­í• 
* Loggingê³¼ ì‹¤íŒ¨ ì²˜ë¦¬
* DAG ë“±ë¡ ë°©ì‹
* Docker ê¸°ë°˜ ìš´ì˜
* ë¡œê·¸ ë¶„ì„ ëŠ¥ë ¥

